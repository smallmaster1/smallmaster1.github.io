(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.Pjax=e()}})(function(){var e,t,o;return function(){function e(t,o,n){function i(s,a){if(!o[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=o[s]={exports:{}};t[s][0].call(u.exports,function(e){var o=t[s][1][e];return i(o||e)},u,u.exports,e,t,o,n)}return o[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}return e}()({1:[function(e,t,o){var n=e("./lib/execute-scripts");var i=e("./lib/foreach-els");var r=e("./lib/parse-options");var s=e("./lib/switches");var a=e("./lib/uniqueid");var l=e("./lib/events/on");var c=e("./lib/events/trigger");var u=e("./lib/util/clone");var f=e("./lib/util/contains");var h=e("./lib/util/extend");var d=e("./lib/util/noop");var p=function(e){this.state={numPendingSwitches:0,href:null,options:null};this.options=r(e);this.log("Pjax options",this.options);if(this.options.scrollRestoration&&"scrollRestoration"in history){history.scrollRestoration="manual"}this.maxUid=this.lastUid=a();this.parseDOM(document);l(window,"popstate",function(e){if(e.state){var t=u(this.options);t.url=e.state.url;t.title=e.state.title;t.history=false;t.scrollPos=e.state.scrollPos;if(e.state.uid<this.lastUid){t.backward=true}else{t.forward=true}this.lastUid=e.state.uid;this.loadUrl(e.state.url,t)}}.bind(this))};p.switches=s;p.prototype={log:e("./lib/proto/log"),getElements:function(e){return e.querySelectorAll(this.options.elements)},parseDOM:function(t){var o=e("./lib/proto/parse-element");i(this.getElements(t),o,this)},refresh:function(e){this.parseDOM(e||document)},reload:function(){window.location.reload()},attachLink:e("./lib/proto/attach-link"),attachForm:e("./lib/proto/attach-form"),forEachSelectors:function(t,o,n){return e("./lib/foreach-selectors").bind(this)(this.options.selectors,t,o,n)},switchSelectors:function(t,o,n,i){return e("./lib/switches-selectors").bind(this)(this.options.switches,this.options.switchesOptions,t,o,n,i)},latestChance:function(e){window.location=e},onSwitch:function(){c(window,"resize scroll");this.state.numPendingSwitches--;if(this.state.numPendingSwitches===0){this.afterAllSwitches()}},loadContent:function(e,t){if(typeof e!=="string"){c(document,"pjax:complete pjax:error",t);return}var o=document.implementation.createHTMLDocument("pjax");var n=/<html[^>]+>/gi;var i=/\s?[a-z:]+(?:=['"][^'">]+['"])*/gi;var r=e.match(n);if(r&&r.length){r=r[0].match(i);if(r.length){r.shift();r.forEach(function(e){var t=e.trim().split("=");if(t.length===1){o.documentElement.setAttribute(t[0],true)}else{o.documentElement.setAttribute(t[0],t[1].slice(1,-1))}})}}o.documentElement.innerHTML=e;this.log("load content",o.documentElement.attributes,o.documentElement.innerHTML.length);if(document.activeElement&&f(document,this.options.selectors,document.activeElement)){try{document.activeElement.blur()}catch(s){}}this.switchSelectors(this.options.selectors,o,document,t)},abortRequest:e("./lib/abort-request"),doRequest:e("./lib/send-request"),handleResponse:e("./lib/proto/handle-response"),loadUrl:function(e,t){t=typeof t==="object"?h({},this.options,t):u(this.options);this.log("load href",e,t);this.abortRequest(this.request);c(document,"pjax:send",t);this.request=this.doRequest(e,t,this.handleResponse.bind(this))},afterAllSwitches:function(){var e=Array.prototype.slice.call(document.querySelectorAll("[autofocus]")).pop();if(e&&document.activeElement!==e){e.focus()}this.options.selectors.forEach(function(e){i(document.querySelectorAll(e),function(e){n(e)})});var t=this.state;if(t.options.history){if(!window.history.state){this.lastUid=this.maxUid=a();window.history.replaceState({url:window.location.href,title:document.title,uid:this.maxUid,scrollPos:[0,0]},document.title)}this.lastUid=this.maxUid=a();window.history.pushState({url:t.href,title:t.options.title,uid:this.maxUid,scrollPos:[0,0]},t.options.title,t.href)}this.forEachSelectors(function(e){this.parseDOM(e)},this);c(document,"pjax:complete pjax:success",t.options);if(typeof t.options.analytics==="function"){t.options.analytics()}if(t.options.history){var o=document.createElement("a");o.href=this.state.href;if(o.hash){var r=o.hash.slice(1);r=decodeURIComponent(r);var s=0;var l=document.getElementById(r)||document.getElementsByName(r)[0];if(l){if(l.offsetParent){do{s+=l.offsetTop;l=l.offsetParent}while(l)}}window.scrollTo(0,s)}else if(t.options.scrollTo!==false){if(t.options.scrollTo.length>1){window.scrollTo(t.options.scrollTo[0],t.options.scrollTo[1])}else{window.scrollTo(0,t.options.scrollTo)}}}else if(t.options.scrollRestoration&&t.options.scrollPos){window.scrollTo(t.options.scrollPos[0],t.options.scrollPos[1])}this.state={numPendingSwitches:0,href:null,options:null}}};p.isSupported=e("./lib/is-supported");if(p.isSupported()){t.exports=p}else{var m=d;for(var v in p.prototype){if(p.prototype.hasOwnProperty(v)&&typeof p.prototype[v]==="function"){m[v]=d}}t.exports=m}},{"./lib/abort-request":2,"./lib/events/on":4,"./lib/events/trigger":5,"./lib/execute-scripts":6,"./lib/foreach-els":7,"./lib/foreach-selectors":8,"./lib/is-supported":9,"./lib/parse-options":10,"./lib/proto/attach-form":11,"./lib/proto/attach-link":12,"./lib/proto/handle-response":13,"./lib/proto/log":14,"./lib/proto/parse-element":15,"./lib/send-request":16,"./lib/switches":18,"./lib/switches-selectors":17,"./lib/uniqueid":19,"./lib/util/clone":20,"./lib/util/contains":21,"./lib/util/extend":22,"./lib/util/noop":23}],2:[function(e,t,o){var n=e("./util/noop");t.exports=function(e){if(e&&e.readyState<4){e.onreadystatechange=n;e.abort()}}},{"./util/noop":23}],3:[function(e,t,o){t.exports=function(e){var t=e.text||e.textContent||e.innerHTML||"";var o=e.src||"";var n=e.parentNode||document.querySelector("head")||document.documentElement;var i=document.createElement("script");if(t.match("document.write")){if(console&&console.log){console.log("Script contains document.write. Can’t be executed correctly. Code skipped ",e)}return false}i.type="text/javascript";i.id=e.id;if(o!==""){i.src=o;i.async=false}if(t!==""){try{i.appendChild(document.createTextNode(t))}catch(r){i.text=t}}n.appendChild(i);if((n instanceof HTMLHeadElement||n instanceof HTMLBodyElement)&&n.contains(i)){n.removeChild(i)}return true}},{}],4:[function(e,t,o){var n=e("../foreach-els");t.exports=function(e,t,o,i){t=typeof t==="string"?t.split(" "):t;t.forEach(function(t){n(e,function(e){e.addEventListener(t,o,i)})})}},{"../foreach-els":7}],5:[function(e,t,o){var n=e("../foreach-els");t.exports=function(e,t,o){t=typeof t==="string"?t.split(" "):t;t.forEach(function(t){var i;i=document.createEvent("HTMLEvents");i.initEvent(t,true,true);i.eventName=t;if(o){Object.keys(o).forEach(function(e){i[e]=o[e]})}n(e,function(e){var t=false;if(!e.parentNode&&e!==document&&e!==window){t=true;document.body.appendChild(e)}e.dispatchEvent(i);if(t){e.parentNode.removeChild(e)}})})}},{"../foreach-els":7}],6:[function(e,t,o){var n=e("./foreach-els");var i=e("./eval-script");t.exports=function(e){if(e.tagName.toLowerCase()==="script"){i(e)}n(e.querySelectorAll("script"),function(e){if(!e.type||e.type.toLowerCase()==="text/javascript"){if(e.parentNode){e.parentNode.removeChild(e)}i(e)}})}},{"./eval-script":3,"./foreach-els":7}],7:[function(e,t,o){t.exports=function(e,t,o){if(e instanceof HTMLCollection||e instanceof NodeList||e instanceof Array){return Array.prototype.forEach.call(e,t,o)}return t.call(o,e)}},{}],8:[function(e,t,o){var n=e("./foreach-els");t.exports=function(e,t,o,i){i=i||document;e.forEach(function(e){n(i.querySelectorAll(e),t,o)})}},{"./foreach-els":7}],9:[function(e,t,o){t.exports=function(){return window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/)}},{}],10:[function(e,t,o){var n=e("./switches");t.exports=function(e){e=e||{};e.elements=e.elements||"a[href], form[action]";e.selectors=e.selectors||["title",".js-Pjax"];e.switches=e.switches||{};e.switchesOptions=e.switchesOptions||{};e.history=typeof e.history==="undefined"?true:e.history;e.analytics=typeof e.analytics==="function"||e.analytics===false?e.analytics:i;e.scrollTo=typeof e.scrollTo==="undefined"?0:e.scrollTo;e.scrollRestoration=typeof e.scrollRestoration!=="undefined"?e.scrollRestoration:true;e.cacheBust=typeof e.cacheBust==="undefined"?true:e.cacheBust;e.debug=e.debug||false;e.timeout=e.timeout||0;e.currentUrlFullReload=typeof e.currentUrlFullReload==="undefined"?false:e.currentUrlFullReload;if(!e.switches.head){e.switches.head=n.switchElementsAlt}if(!e.switches.body){e.switches.body=n.switchElementsAlt}return e};function i(){if(window._gaq){_gaq.push(["_trackPageview"])}if(window.ga){ga("send","pageview",{page:location.pathname,title:document.title})}}},{"./switches":18}],11:[function(e,t,o){var n=e("../events/on");var i=e("../util/clone");var r="data-pjax-state";var s=function(e,t){if(c(t)){return}var o=i(this.options);o.requestOptions={requestUrl:e.getAttribute("action")||window.location.href,requestMethod:e.getAttribute("method")||"GET"};var n=document.createElement("a");n.setAttribute("href",o.requestOptions.requestUrl);var s=l(n,o);if(s){e.setAttribute(r,s);return}t.preventDefault();if(e.enctype==="multipart/form-data"){o.requestOptions.formData=new FormData(e)}else{o.requestOptions.requestParams=a(e)}e.setAttribute(r,"submit");o.triggerElement=e;this.loadUrl(n.href,o)};function a(e){var t=[];var o=e.elements;for(var n=0;n<o.length;n++){var i=o[n];var r=i.tagName.toLowerCase();if(!!i.name&&i.attributes!==undefined&&r!=="button"){var s=i.attributes.type;if(!s||s.value!=="checkbox"&&s.value!=="radio"||i.checked){var a=[];if(r==="select"){var l;for(var c=0;c<i.options.length;c++){l=i.options[c];if(l.selected&&!l.disabled){a.push(l.hasAttribute("value")?l.value:l.text)}}}else{a.push(i.value)}for(var u=0;u<a.length;u++){t.push({name:encodeURIComponent(i.name),value:encodeURIComponent(a[u])})}}}}return t}function l(e,t){if(e.protocol!==window.location.protocol||e.host!==window.location.host){return"external"}if(e.hash&&e.href.replace(e.hash,"")===window.location.href.replace(location.hash,"")){return"anchor"}if(e.href===window.location.href.split("#")[0]+"#"){return"anchor-empty"}if(t.currentUrlFullReload&&e.href===window.location.href.split("#")[0]){return"reload"}}var c=function(e){return e.defaultPrevented||e.returnValue===false};t.exports=function(e){var t=this;e.setAttribute(r,"");n(e,"submit",function(o){s.call(t,e,o)})}},{"../events/on":4,"../util/clone":20}],12:[function(e,t,o){var n=e("../events/on");var i=e("../util/clone");var r="data-pjax-state";var s=function(e,t){if(l(t)){return}var o=i(this.options);var n=a(e,t);if(n){e.setAttribute(r,n);return}t.preventDefault();if(this.options.currentUrlFullReload&&e.href===window.location.href.split("#")[0]){e.setAttribute(r,"reload");this.reload();return}e.setAttribute(r,"load");o.triggerElement=e;this.loadUrl(e.href,o)};function a(e,t){if(t.which>1||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey){return"modifier"}if(e.protocol!==window.location.protocol||e.host!==window.location.host){return"external"}if(e.hash&&e.href.replace(e.hash,"")===window.location.href.replace(location.hash,"")){return"anchor"}if(e.href===window.location.href.split("#")[0]+"#"){return"anchor-empty"}}var l=function(e){return e.defaultPrevented||e.returnValue===false};t.exports=function(e){var t=this;e.setAttribute(r,"");n(e,"click",function(o){s.call(t,e,o)});n(e,"keyup",function(o){if(o.keyCode===13){s.call(t,e,o)}}.bind(this))}},{"../events/on":4,"../util/clone":20}],13:[function(e,t,o){var n=e("../util/clone");var i=e("../uniqueid");var r=e("../events/trigger");t.exports=function(e,t,o,s){s=n(s||this.options);s.request=t;if(e===false){r(document,"pjax:complete pjax:error",s);return}var a=window.history.state||{};window.history.replaceState({url:a.url||window.location.href,title:a.title||document.title,uid:a.uid||i(),scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]},document.title,window.location.href);var l=o;if(t.responseURL){if(o!==t.responseURL){o=t.responseURL}}else if(t.getResponseHeader("X-PJAX-URL")){o=t.getResponseHeader("X-PJAX-URL")}else if(t.getResponseHeader("X-XHR-Redirected-To")){o=t.getResponseHeader("X-XHR-Redirected-To")}var c=document.createElement("a");c.href=l;var u=c.hash;c.href=o;if(u&&!c.hash){c.hash=u;o=c.href}this.state.href=o;this.state.options=s;try{this.loadContent(e,s)}catch(f){r(document,"pjax:error",s);if(!this.options.debug){if(console&&console.error){console.error("Pjax switch fail: ",f)}return this.latestChance(o)}else{throw f}}}},{"../events/trigger":5,"../uniqueid":19,"../util/clone":20}],14:[function(e,t,o){t.exports=function(){if(this.options.debug&&console){if(typeof console.log==="function"){console.log.apply(console,arguments)}else if(console.log){console.log(arguments)}}}},{}],15:[function(e,t,o){var n="data-pjax-state";t.exports=function(e){switch(e.tagName.toLowerCase()){case"a":if(!e.hasAttribute(n)){this.attachLink(e)}break;case"form":if(!e.hasAttribute(n)){this.attachForm(e)}break;default:throw"Pjax can only be applied on <a> or <form> submit"}}},{}],16:[function(e,t,o){var n=e("./util/update-query-string");t.exports=function(e,t,o){t=t||{};var i;var r=t.requestOptions||{};var s=(r.requestMethod||"GET").toUpperCase();var a=r.requestParams||null;var l=r.formData||null;var c=null;var u=new XMLHttpRequest;var f=t.timeout||0;u.onreadystatechange=function(){if(u.readyState===4){if(u.status===200){o(u.responseText,u,e,t)}else if(u.status!==0){o(null,u,e,t)}}};u.onerror=function(n){console.log(n);o(null,u,e,t)};u.ontimeout=function(){o(null,u,e,t)};if(a&&a.length){i=a.map(function(e){return e.name+"="+e.value}).join("&");switch(s){case"GET":e=e.split("?")[0];e+="?"+i;break;case"POST":c=i;break}}else if(l){c=l}if(t.cacheBust){e=n(e,"t",Date.now())}u.open(s,e,true);u.timeout=f;u.setRequestHeader("X-Requested-With","XMLHttpRequest");u.setRequestHeader("X-PJAX","true");u.setRequestHeader("X-PJAX-Selectors",JSON.stringify(t.selectors));if(c&&s==="POST"&&!l){u.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}u.send(c);return u}},{"./util/update-query-string":24}],17:[function(e,t,o){var n=e("./foreach-els");var i=e("./switches");t.exports=function(e,t,o,r,s,a){var l=[];o.forEach(function(o){var c=r.querySelectorAll(o);var u=s.querySelectorAll(o);if(this.log){this.log("Pjax switch",o,c,u)}if(c.length!==u.length){throw"DOM doesn’t look the same on new loaded page: ’"+o+"’ - new "+c.length+", old "+u.length}n(c,function(n,r){var s=u[r];if(this.log){this.log("newEl",n,"oldEl",s)}var c=e[o]?e[o].bind(this,s,n,a,t[o]):i.outerHTML.bind(this,s,n,a);l.push(c)},this)},this);this.state.numPendingSwitches=l.length;l.forEach(function(e){e()})}},{"./foreach-els":7,"./switches":18}],18:[function(e,t,o){var n=e("./events/on");t.exports={outerHTML:function(e,t){e.outerHTML=t.outerHTML;this.onSwitch()},innerHTML:function(e,t){e.innerHTML=t.innerHTML;if(t.className===""){e.removeAttribute("class")}else{e.className=t.className}this.onSwitch()},switchElementsAlt:function(e,t){e.innerHTML=t.innerHTML;if(t.hasAttributes()){var o=t.attributes;for(var n=0;n<o.length;n++){e.attributes.setNamedItem(o[n].cloneNode())}}this.onSwitch()},replaceNode:function(e,t){e.parentNode.replaceChild(t,e);this.onSwitch()},sideBySide:function(e,t,o,i){var r=Array.prototype.forEach;var s=[];var a=[];var l=document.createDocumentFragment();var c="animationend webkitAnimationEnd MSAnimationEnd oanimationend";var u=0;var f=function(e){if(e.target!==e.currentTarget){return}u--;if(u<=0&&s){s.forEach(function(e){if(e.parentNode){e.parentNode.removeChild(e)}});a.forEach(function(e){e.className=e.className.replace(e.getAttribute("data-pjax-classes"),"");e.removeAttribute("data-pjax-classes")});a=null;s=null;this.onSwitch()}}.bind(this);i=i||{};r.call(e.childNodes,function(e){s.push(e);if(e.classList&&!e.classList.contains("js-Pjax-remove")){if(e.hasAttribute("data-pjax-classes")){e.className=e.className.replace(e.getAttribute("data-pjax-classes"),"");e.removeAttribute("data-pjax-classes")}e.classList.add("js-Pjax-remove");if(i.callbacks&&i.callbacks.removeElement){i.callbacks.removeElement(e)}if(i.classNames){e.className+=" "+i.classNames.remove+" "+(o.backward?i.classNames.backward:i.classNames.forward)}u++;n(e,c,f,true)}});r.call(t.childNodes,function(e){if(e.classList){var t="";if(i.classNames){t=" js-Pjax-add "+i.classNames.add+" "+(o.backward?i.classNames.forward:i.classNames.backward)}if(i.callbacks&&i.callbacks.addElement){i.callbacks.addElement(e)}e.className+=t;e.setAttribute("data-pjax-classes",t);a.push(e);l.appendChild(e);u++;n(e,c,f,true)}});e.className=t.className;e.appendChild(l)}}},{"./events/on":4}],19:[function(e,t,o){t.exports=function(){var e=0;return function(){var t="pjax"+(new Date).getTime()+"_"+e;e++;return t}}()},{}],20:[function(e,t,o){t.exports=function(e){if(null===e||"object"!==typeof e){return e}var t=e.constructor();for(var o in e){if(e.hasOwnProperty(o)){t[o]=e[o]}}return t}},{}],21:[function(e,t,o){t.exports=function n(e,t,o){for(var n=0;n<t.length;n++){var i=e.querySelectorAll(t[n]);for(var r=0;r<i.length;r++){if(i[r].contains(o)){return true}}}return false}},{}],22:[function(e,t,o){t.exports=function(e){if(e==null){return null}var t=Object(e);for(var o=1;o<arguments.length;o++){var n=arguments[o];if(n!=null){for(var i in n){if(Object.prototype.hasOwnProperty.call(n,i)){t[i]=n[i]}}}}return t}},{}],23:[function(e,t,o){t.exports=function(){}},{}],24:[function(e,t,o){t.exports=function(e,t,o){var n=new RegExp("([?&])"+t+"=.*?(&|$)","i");var i=e.indexOf("?")!==-1?"&":"?";if(e.match(n)){return e.replace(n,"$1"+t+"="+o+"$2")}else{return e+i+t+"="+o}}},{}]},{},[1])(1)});